{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { BehaviorSubject, tap } from 'rxjs';\nimport { environment } from '../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./auth.service\";\nexport let OrderService = /*#__PURE__*/(() => {\n  class OrderService {\n    http;\n    auth;\n    apiUrl = `${environment.apiUrl}/api/orders`;\n    cartSubject = new BehaviorSubject([]);\n    cart$ = this.cartSubject.asObservable();\n    cartCountSubject = new BehaviorSubject(0);\n    cartCount$ = this.cartCountSubject.asObservable();\n    constructor(http, auth) {\n      this.http = http;\n      this.auth = auth;\n    }\n    getHeaders() {\n      const token = this.auth.getToken() || '';\n      return {\n        headers: new HttpHeaders({\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`\n        })\n      };\n    }\n    /** ======================= Cart Management ======================= */\n    setCart(items) {\n      this.cartSubject.next(items);\n      this.updateCartCount(items);\n    }\n    updateCartCount(items) {\n      const count = items.reduce((sum, i) => sum + (i.quantity || 0), 0);\n      this.cartCountSubject.next(count);\n    }\n    loadCartCount() {\n      this.getCurrentOrder().subscribe({\n        next: order => this.setCart(order?.items || []),\n        error: () => this.setCart([])\n      });\n    }\n    getCurrentOrder() {\n      return this.http.get(`${this.apiUrl}/my/current`, this.getHeaders()).pipe(tap(order => this.setCart(order.items || [])));\n    }\n    /** ======================= Cart Operations ======================= */\n    addItemToCart(productId, quantity = 1, size = '') {\n      return this.http.post(`${this.apiUrl}/add-to-cart`, {\n        productId,\n        quantity,\n        size\n      }, this.getHeaders()).pipe(tap(order => this.setCart(order.items || [])));\n    }\n    removeItemFromCart(productId) {\n      return this.http.delete(`${this.apiUrl}/remove-from-cart/${productId}`, this.getHeaders()).pipe(tap(order => this.setCart(order.items || [])));\n    }\n    updateProductQuantity(orderId, productId, quantity) {\n      return this.http.put(`${this.apiUrl}/${orderId}/product/${productId}`, {\n        quantity\n      }, this.getHeaders()).pipe(tap(order => this.setCart(order.items || [])));\n    }\n    updateCartItems(items) {\n      return this.http.put(`${this.apiUrl}/update-cart`, {\n        items\n      }, this.getHeaders()).pipe(tap(order => this.setCart(order.items || items)));\n    }\n    confirmOrder(orderId, details) {\n      return this.http.put(`${this.apiUrl}/${orderId}/confirm`, details, this.getHeaders());\n    }\n    getMyOrders() {\n      return this.http.get(`${this.apiUrl}/my`, this.getHeaders());\n    }\n    static ɵfac = function OrderService_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || OrderService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.AuthService));\n    };\n    static ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: OrderService,\n      factory: OrderService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n  return OrderService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}