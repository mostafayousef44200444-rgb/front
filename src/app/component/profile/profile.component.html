<div class="profile-header shadow-sm"></div>

<div class="container pb-5">
  <div class="row mt-n5">
    
    <div class="col-lg-4">
      <div class="card custom-card shadow-sm text-center p-4 mb-4 mt-n5">
        <div class="profile-avatar-wrapper">
          <img [src]="'https://ui-avatars.com/api/?name=' + user.firstName + '+' + user.lastName + '&background=6366f1&color=fff&size=128'" 
               class="rounded-circle profile-img mb-3">
        </div>
        
        <h4 class="fw-bold mb-1">{{user.firstName}} {{user.lastName}}</h4>
        <p class="text-muted small mb-4">{{user.email}}</p>

        <div class="nav flex-column nav-pills text-start">
          <button class="nav-link" [class.active]="activeTab === 'dashboard'" (click)="activeTab = 'dashboard'">
            <i class="bi bi-grid me-2"></i> Dashboard
          </button>
          <button class="nav-link d-flex justify-content-between align-items-center" 
                  [class.active]="activeTab === 'orders'" (click)="activeTab = 'orders'">
            <span><i class="bi bi-bag me-2"></i> My Orders</span>
            <span class="badge bg-secondary rounded-pill small">{{orders.length}}</span>
          </button>
          <hr>
          <button class="nav-link text-danger shadow-none" (click)="logout()">
            <i class="bi bi-box-arrow-right me-2"></i> Logout
          </button>
        </div>
      </div>
    </div>

    <div class="col-lg-8">
      
      <div *ngIf="activeTab === 'dashboard'" class="animate__animated animate__fadeIn">
        <div class="row g-3 mb-4">
          <div class="col-md-6">
            <div class="card custom-card p-4 bg-white shadow-sm border-0">
              <p class="text-muted small mb-1 text-uppercase fw-bold">Total Spent</p>
              <h3 class="fw-bold text-dark">{{totalSpent | number}} <small class="fs-6">EGP</small></h3>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card custom-card p-4 bg-white shadow-sm border-0">
              <p class="text-muted small mb-1 text-uppercase fw-bold">Member Status</p>
              <h3 class="fw-bold text-success">Verified</h3>
            </div>
          </div>
        </div>

        <div class="card custom-card shadow-sm p-4 border-0">
          <h5 class="fw-bold mb-4">Profile Details</h5>
          <div class="row g-4">
            <div class="col-sm-6">
              <label class="text-muted small d-block">Full Name</label>
              <span class="fw-medium">{{user.firstName}} {{user.lastName}}</span>
            </div>
            <div class="col-sm-6">
              <label class="text-muted small d-block">Account Email</label>
              <span class="fw-medium">{{user.email}}</span>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="activeTab === 'orders'" class="animate__animated animate__fadeIn">
        <h4 class="fw-bold mb-4">Order History</h4>
        
        <div *ngIf="orders.length === 0" class="text-center py-5 bg-white rounded-4 shadow-sm">
          <i class="bi bi-cart-x display-4 text-muted"></i>
          <p class="mt-3 text-muted">You haven't made any orders yet.</p>
        </div>

        <div *ngFor="let order of orders" class="card custom-card order-card shadow-sm mb-4 border-0">
          <div class="card-header bg-white border-0 py-3 d-flex justify-content-between align-items-center">
            <div>
              <span class="text-muted small">Order #</span>
              <span class="fw-bold ms-1 text-uppercase">{{order._id.slice(-6)}}</span>
            </div>
            <span class="badge status-badge" 
                  [ngClass]="order.status === 'Completed' ? 'bg-light-success text-success' : 'bg-light-primary text-primary'"
                  style="background-color: #ecfdf5; color: #059669;">
              {{order.status || 'Confirmed'}}
            </span>
          </div>
          
          <div class="card-body pt-0">
            <div *ngFor="let item of order.items" class="item-row d-flex align-items-center">
              <img [src]="item.image" class="rounded-3 me-3" width="60" height="60" style="object-fit: cover;">
              <div class="flex-grow-1">
                <h6 class="mb-0 fw-bold small">{{item.name}}</h6>
                <small class="text-muted">Qty: {{item.quantity}} | Price: {{item.price}} EGP</small>
              </div>
              <div class="text-end fw-bold">
                {{item.price * item.quantity}} EGP
              </div>
            </div>
          </div>

          <div class="card-footer bg-light border-0 py-3 d-flex justify-content-between">
            <span class="fw-bold text-muted">Total Paid</span>
            <span class="fw-bold text-primary">{{order.total || calculateOrderTotal(order)}} EGP</span>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>